import{j as e,aa as k,A as z,l as f,dw as q,h as B,I as v,n as K,B as H,o as W,ev as V,ew as X,ab as Z,ex as J,H as ee,a as te,av as se,b6 as ne,u as F,b as ae,aP as x,af as ie,aM as re,r as L,ey as oe,ez as le,eA as ce,aY as N,eB as de,eC as ue,q as pe,eD as ge,eE as he,bq as fe,cN as h,bu as _,O as me,v as ye,aS as xe,cP as je,aW as Te,d as D,aX as O,L as be,cQ as Le,eF as M}from"./strapi-w1HSthmK.js";import{u as Ce}from"./useDragLayer-DN4IjHWF.js";import{C as Se}from"./CardDragPreview-BbDZyywF.js";import{a as Me,u as A}from"./hooks-DkFoo8lK.js";function Ie(s,n,r){if(!s||!n||!r)return{display:"none"};const{x:t,y:o}=r;return{transform:`translate(${t}px, ${o}px)`}}const De=({renderItem:s})=>{const{itemType:n,isDragging:r,item:t,initialOffset:o,currentOffset:u,mouseOffset:p}=Ce(i=>({item:i.getItem(),itemType:i.getItemType(),initialOffset:i.getInitialSourceClientOffset(),currentOffset:i.getSourceClientOffset(),isDragging:i.isDragging(),mouseOffset:i.getClientOffset()}));return r?e.jsx(k,{height:"100%",left:0,position:"fixed",pointerEvents:"none",top:0,zIndex:100,width:"100%",children:e.jsx(k,{style:Ie(o,u,p),children:s({type:n,item:t})})}):null},ke=({displayedValue:s})=>{const n=z();return e.jsxs(f,{background:"neutral0",borderColor:"neutral200",justifyContent:"space-between",gap:3,padding:3,width:"30rem",children:[e.jsx(Pe,{type:"button",children:e.jsxs(f,{gap:6,children:[e.jsx(Ee,{alignItems:"center",justifyContent:"center",background:"neutral200",height:"3.2rem",width:"3.2rem",children:e.jsx(q,{})}),e.jsx(f,{maxWidth:"15rem",children:e.jsx(B,{textColor:"neutral700",ellipsis:!0,children:s})})]})}),e.jsxs(f,{gap:2,children:[e.jsx(v,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(K,{})}),n&&e.jsx(v,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(H,{})})]})]})},Ee=W(f)`
  border-radius: 50%;

  svg {
    height: 0.6rem;
    width: 1.1rem;
    > path {
      fill: ${({theme:s})=>s.colors.neutral600};
    }
  }
`,Pe=W.button`
  border: none;
  background: transparent;
  display: block;
  width: 100%;
  text-align: unset;
  padding: 0;
`,we=({status:s,displayedValue:n,width:r})=>{const t=z();return e.jsx(k,{style:{width:r},children:e.jsxs(f,{paddingTop:2,paddingBottom:2,paddingLeft:2,paddingRight:4,hasRadius:!0,borderWidth:1,background:"neutral0",borderColor:"neutral200",justifyContent:"space-between",gap:4,children:[e.jsxs(V,{gap:1,children:[t&&e.jsx(v,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(H,{})}),e.jsxs(f,{width:"100%",minWidth:0,justifyContent:"space-between",children:[e.jsx(k,{minWidth:0,paddingTop:1,paddingBottom:1,paddingRight:4,children:e.jsx(X,{href:"",children:e.jsx(B,{textColor:"primary600",ellipsis:!0,children:n})})}),s?e.jsx(Z,{status:s}):null]})]}),e.jsx(J,{type:"button",children:e.jsx(ee,{width:"12px"})})]})})},{MUTATE_COLLECTION_TYPES_LINKS:Oe,MUTATE_SINGLE_TYPES_LINKS:ve}=le,Q=()=>{const{toggleNotification:s}=te(),n=Me(),r=se("useContentManagerInitData",g=>g.runHookWaterfall),{notifyStatus:t}=ne(),{formatMessage:o}=F(),{_unstableFormatAPIError:u}=ae(x),p=ie("useContentManagerInitData",g=>g.checkUserHasPermissions),i=A(g=>g["content-manager"].app),a=re(void 0,{refetchOnMountOrArgChange:!0});L.useEffect(()=>{a.data&&t(o({id:x("App.schemas.data-loaded"),defaultMessage:"The schemas have been successfully loaded."}))},[o,a.data,t]),L.useEffect(()=>{a.error&&s({type:"danger",message:u(a.error)})},[u,a.error,s]);const d=oe();L.useEffect(()=>{d.error&&s({type:"danger",message:u(d.error)})},[u,d.error,s]);const m=async(g,T,E,P)=>{const{collectionType:j,singleType:w}=T.reduce((y,b)=>(y[b.kind].push(b),y),{collectionType:[],singleType:[]}),l=R(j,"collectionTypes",P),c=R(w,"singleTypes"),C=await Promise.all(l.map(({permissions:y})=>p(y))),S=l.filter((y,b)=>C[b].length>0),I=await Promise.all(c.map(({permissions:y})=>p(y))),Y=c.filter((y,b)=>I[b].length>0),{ctLinks:G}=r(Oe,{ctLinks:S,models:T}),{stLinks:U}=r(ve,{stLinks:Y,models:T});n(ce({authorizedCollectionTypeLinks:G,authorizedSingleTypeLinks:U,components:g,contentTypeSchemas:T,fieldSizes:E}))};return L.useEffect(()=>{a.data&&d.data&&m(a.data.components,a.data.contentTypes,a.data.fieldSizes,d.data)},[a.data,d.data]),{...i}},R=(s,n,r=[])=>s.filter(t=>t.isDisplayed).map(t=>{const o=[{action:"plugin::content-manager.explorer.create",subject:t.uid},{action:"plugin::content-manager.explorer.read",subject:t.uid}],u=[{action:"plugin::content-manager.explorer.read",subject:t.uid}],p=n==="collectionTypes"?o:u,i=r.find(({uid:d})=>d===t.uid);let a=null;if(i){const d={page:1,pageSize:i.settings.pageSize,sort:`${i.settings.defaultSortBy}:${i.settings.defaultSortOrder}`};a=N.stringify(d,{encode:!1})}return{permissions:p,search:a,kind:t.kind,title:t.info.displayName,to:`/content-manager/${t.kind==="collectionType"?de:ue}/${t.uid}`,uid:t.uid,name:t.uid,isDisplayed:t.isDisplayed}}),$=({isFullPage:s=!1})=>{const[n,r]=L.useState(""),[{query:t}]=pe(),{formatMessage:o,locale:u}=F(),{isLoading:p}=Q(),i=A(l=>l["content-manager"].app.collectionTypeLinks),a=A(l=>l["content-manager"].app.singleTypeLinks),{schemas:d}=ge(),{contains:m}=he(u,{sensitivity:"base"}),g=fe(u,{sensitivity:"base"}),T=L.useMemo(()=>[{id:"collectionTypes",title:o({id:x("components.LeftMenu.collection-types"),defaultMessage:"Collection Types"}),searchable:!0,links:i},{id:"singleTypes",title:o({id:x("components.LeftMenu.single-types"),defaultMessage:"Single Types"}),searchable:!0,links:a}].map(l=>({...l,links:l.links.filter(c=>m(c.title,n.trim())).sort((c,C)=>g.compare(c.title,C.title)).map(c=>({...c,title:o({id:c.title,defaultMessage:c.title})}))})),[i,n,a,m,o,g]),E=()=>{r("")},P=l=>{r(l.target.value)},j=o({id:x("header.name"),defaultMessage:"Content Manager"}),w=l=>{const C=!!d.find(S=>S.uid===l.uid)?.pluginOptions?.i18n?.localized;if(t.plugins&&"i18n"in t.plugins){const{i18n:S,...I}=t.plugins;return C?{i18n:S,...I}:I}return t.plugins};return p?e.jsxs(h.Main,{"aria-label":j,children:[e.jsx(h.Header,{label:j}),e.jsx(_,{}),e.jsx(f,{padding:4,justifyContent:"center",children:e.jsx(me,{})})]}):e.jsxs(h.Main,{"aria-label":j,children:[!s&&e.jsxs(e.Fragment,{children:[e.jsx(h.Header,{label:j}),e.jsx(_,{})]}),e.jsxs(h.Content,{children:[s&&e.jsx(h.Header,{label:j}),e.jsx(f,{paddingLeft:{initial:4,large:5},paddingRight:{initial:4,large:5},paddingTop:s?0:{initial:4,large:5},paddingBottom:0,gap:3,direction:"column",alignItems:"stretch",children:e.jsx(ye,{value:n,onChange:P,onClear:E,placeholder:o({id:"search.placeholder",defaultMessage:"Search"}),size:"S",children:void 0,name:"search_contentType",clearLabel:o({id:"clearLabel",defaultMessage:"Clear"})})}),e.jsx(h.Sections,{children:T.map(l=>e.jsx(h.Section,{label:l.title,badgeLabel:l.links.length.toString(),children:l.links.map(c=>e.jsx(h.Link,{to:{pathname:c.to,search:N.stringify({...N.parse(c.search??""),plugins:w(c)})},label:c.title},c.uid))},l.id))})]})]})},$e=()=>{const s=xe("/content-manager/:kind/:uid/*"),n=je(),{isLoading:r,collectionTypeLinks:t,models:o,singleTypeLinks:u}=Q(),p=[...t,...u].sort((m,g)=>m.title.localeCompare(g.title)),{pathname:i}=Te(),{formatMessage:a}=F();if(r)return e.jsxs(e.Fragment,{children:[e.jsx(D.Title,{children:a({id:x("plugin.name"),defaultMessage:"Content Manager"})}),e.jsx(D.Loading,{})]});const d=o.filter(({isDisplayed:m})=>m);return p.length===0&&d.length>0&&i!=="/content-manager/403"?e.jsx(O,{to:"/403"}):d.length===0&&i!=="/no-content-types"?e.jsx(O,{to:"/no-content-types"}):!s&&p.length>0?n?e.jsxs(e.Fragment,{children:[e.jsx(D.Title,{children:a({id:x("plugin.name"),defaultMessage:"Content Manager"})}),e.jsx(h.PageWrapper,{children:e.jsx($,{isFullPage:!0})})]}):e.jsx(O,{to:{pathname:p[0].to,search:p[0].search??""},replace:!0}):e.jsxs(e.Fragment,{children:[e.jsx(D.Title,{children:a({id:x("plugin.name"),defaultMessage:"Content Manager"})}),e.jsxs(be.Root,{sideNav:e.jsx($,{}),children:[e.jsx(De,{renderItem:Ne}),e.jsx(Le,{})]})]})};function Ne({type:s,item:n}){if(!s||s&&typeof s!="string")return null;const[r]=s.split("_");switch(r){case M.EDIT_FIELD:case M.FIELD:return e.jsx(Se,{label:n.label});case M.COMPONENT:case M.DYNAMIC_ZONE:return e.jsx(ke,{displayedValue:n.displayedValue});case M.RELATION:return e.jsx(we,{...n});default:return null}}export{$e as Layout};
